<!DOCTYPE html>
<html lang=>
  <head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <meta name="description" content>
  <meta name="keywords" content>
  
    <link rel="icon" href>
  
    
  <title>è®°ä¸¤æ¬¡ASTçš„åº”ç”¨ | qqqdu&#39;s blog</title>
  <link rel="stylesheet" href="/style.css">
  <link rel="stylesheet" href="/lib/jquery.fancybox.min.css">
  <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
</head>

<body>
  <header>
  <div class="header-container">
    <a class='logo' href="/">
      <span>qqqdu's blog</span>
    </a>
    <ul class="right-header">
      
        <li class="nav-item">
          
            <a href="/" class="item-link">é¦–é¡µ</a>
          
        </li>
      
        <li class="nav-item">
          
            <a href="/about" class="item-link">å…³äº</a>
          
        </li>
      
        <li class="nav-item">
          
            <a href="/archives" class="item-link">å½’æ¡£</a>
          
        </li>
      
        <li class="nav-item">
          
            <a href="/tags" class="item-link">æ ‡ç­¾</a>
          
        </li>
      
    </ul>
  </div>
</header>

  <main id='post'>
  <div class="content">
    <article>
        <section class="content markdown-body">
          <h1>è®°ä¸¤æ¬¡ASTçš„åº”ç”¨</h1>
          <div class='post-meta'>
            <i class="fa fa-calendar" aria-hidden="true"></i> <time>2019/09/01</time>
            
            
          </div>
          <p>ç»ˆäºå°† AST ç”¨åœ¨éœ€æ±‚é‡Œè¾£ï¼</p>
<h2 id="AST-å’Œ-æˆ‘"><a href="#AST-å’Œ-æˆ‘" class="headerlink" title="AST å’Œ æˆ‘"></a>AST å’Œ æˆ‘</h2><p>ä¹‹å‰æœ‰åœ¨ TOH å‰ç«¯å°ç»„é‡Œåˆ†äº«è¿‡ AST çš„ç›¸å…³æ¦‚å¿µï¼Œä»¥åŠ <code>recast</code> åº“æ¥æ“ä½œ AST æ ‘ï¼Œ<br>ä½ å¯ä»¥åœ¨è¿™çœ‹è¿™ç¯‡æ–‡ç« </p>
<p><a href="http://qqqdu.com/2019/03/18/javascript-parse/" target="_blank" rel="noopener">æŠ½è±¡è¯­æ³•æ ‘(AST)</a></p>
<p>å½“æ—¶åˆ†äº«å®Œè§‰å¾—å¾ˆç©ºæ—·ï¼Œè™½ç„¶äº†è§£äº†å…¶éƒ¨åˆ†åŸºç¡€æ¦‚å¿µï¼Œä¹Ÿåšäº†ä¸€ä¸ªå° demoï¼Œä½†è¿˜æ˜¯å¤ªè¿‡äºè¡¨é¢ï¼Œæ²¡æœ‰å®é™…åº”ç”¨ï¼Œçº¸ä¸Šå¾—æ¥ç»ˆè§‰æµ…ã€‚æ°å¥½è¿™å‘¨æœ‰ä¸¤æ¬¡æœºä¼šç”¨ä¸Šäº† ASTã€‚<br>æˆ‘çš„ä½“éªŒæ˜¯ï¼š</p>
<p>çœŸ TMD çˆ½ï¼</p>
<h2 id="æšä¸¾åº“-å’Œ-JSDOC-çš„ç¢°æ’"><a href="#æšä¸¾åº“-å’Œ-JSDOC-çš„ç¢°æ’" class="headerlink" title="æšä¸¾åº“ å’Œ JSDOC çš„ç¢°æ’"></a>æšä¸¾åº“ å’Œ JSDOC çš„ç¢°æ’</h2><p>å½“ xusy æ•´ç†å®Œ é¡¹ç›®çš„æšä¸¾ï¼Œå¹¶å°†å®ƒå°è£…ä¸ºä¸€ä¸ªåº“åï¼ŒMR å‘äº†è¿‡æ¥ã€‚</p>
<p>ä¹‹å‰é¡¹ç›®é‡Œé›¶é›¶æ•£æ•£çš„æšä¸¾ç»Ÿä¸€ç”±ç§æœ‰åº“æ¥ç»´æŠ¤ï¼Œå†ä¹Ÿä¸ç”¨æ¯ä¸ªé¡¹ç›®éƒ½ç»´æŠ¤ä¸€ä»½äº†ã€‚</p>
<p>ä½†æ–‡æ¡£ä¼¼ä¹æœ‰ç‚¹å¤šï¼Œå¥½å‡ åä¸ª js è„šæœ¬ã€‚äºæ˜¯æˆ‘</p>
<p>commitï¼šåº”è¯¥å†å‡ºä¸€ä»½æ–‡æ¡£ï¼Œå‘ŠçŸ¥å¼€å‘è€…è¿™äº›æšä¸¾éƒ½æ˜¯å¹²å•¥çš„ï¼Œè¿™æ ·ä¸éœ€è¦å¼€å‘è€…æ‰¾ä»£ç ï¼Œè€Œç›´æ¥è°ƒç”¨å®ƒã€‚</p>
<p>xusy è¯´ï¼Œå¯ä»¥ï¼Œç„¶åè°ƒç ”äº†ä¸‹ JSDOC åº“ï¼Œå‘ç°ä»£ç æ ¼å¼ä¸ç¬¦åˆ JSDOC çš„è¦æ±‚ã€‚æ¯”å¦‚ï¼š<br>å¤‡æ³¨è¦åƒå‰è€…ï¼Œè€Œä¸æ˜¯åè€…ï¼š<br><code>/** è¿™æ˜¯JSDOCå¯è¯†åˆ«çš„å¤‡æ³¨ */</code><br><code>/* è¿™æ˜¯JSDOCä¸å¯è¯†åˆ«çš„å¤‡æ³¨ */</code></p>
<p>æ¯”å¦‚ï¼š<br>å¯¼å‡ºçš„ç±»å‹è¦åƒå‰è€…ï¼Œè€Œä¸æ˜¯åè€…ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> applyTypeObj = &#123;</span><br><span class="line">	<span class="comment">/** æ™®é€šæŠ•é€’ */</span></span><br><span class="line">	NORMAL_APPLY: <span class="number">0</span>,</span><br><span class="line">	<span class="comment">/** ä¸€é”®æŠ•é€’ */</span></span><br><span class="line">	ONE_CLICK_APPLY: <span class="number">1</span>,</span><br><span class="line">	<span class="comment">/** é‚€è¯·æŠ•é€’ */</span></span><br><span class="line">	INVITE_APPLY: <span class="number">2</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> applyTypeEnum = <span class="built_in">Object</span>.freeze(applyTypeObj)</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ™®é€šæŠ•é€’</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> NORMAL_APPLY = <span class="number">0</span></span><br><span class="line"><span class="comment">// ä¸€é”®æŠ•é€’</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> ONE_CLICK_APPLY = <span class="number">1</span></span><br><span class="line"><span class="comment">// é‚€è¯·æŠ•é€’</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> INVITE_APPLY = <span class="number">2</span></span><br></pre></td></tr></table></figure>
<p>æœ‰ 21 ä¸ªæ–‡ä»¶ã€ä»¥åŠæ–‡ä»¶é‡Œçš„å¤§é‡æšä¸¾ éœ€è¦è¿™æ ·å¤„ç†ï¼Œä½ å¯ä»¥ç®—ç®—éœ€è¦å¤šå°‘äººå·¥æˆæœ¬ï¼Œå¹¶ä¸”å¤„ç†çš„è¿‡ç¨‹æ˜¯æ¯ç‡¥ï¼Œä¹å‘³ï¼Œå®¹æ˜“å‡ºé”™çš„ã€‚</p>
<h3 id="ä½ ä¸ºä»€ä¹ˆä¸é—®é—®ç¥å¥‡çš„-AST-å‘¢"><a href="#ä½ ä¸ºä»€ä¹ˆä¸é—®é—®ç¥å¥‡çš„-AST-å‘¢" class="headerlink" title="ä½ ä¸ºä»€ä¹ˆä¸é—®é—®ç¥å¥‡çš„ AST å‘¢"></a>ä½ ä¸ºä»€ä¹ˆä¸é—®é—®ç¥å¥‡çš„ AST å‘¢</h3><p>æœ‰äº†ä¸Šæ¬¡åˆ†äº«çš„ç»éªŒï¼Œè¿™æ¬¡åº”è¯¥å¾ˆå®¹æ˜“å†™å‡ºè¿™æ ·çš„è½¬æ¢ä»£ç ã€‚<br>å…ˆæ„æ€ä¸‹åŸºæœ¬çš„æµç¨‹</p>
<p>é€’å½’è¯»å–é¡¹ç›®æ–‡ä»¶ -&gt; è¯»æ–‡ä»¶ -&gt; AST æ“ä½œ -&gt; å†™æ–‡ä»¶</p>
<p>è¿™ä¸ªæµç¨‹æ ¸å¿ƒå°±æ˜¯ AST æ“ä½œã€‚ä¾ç„¶ç”¨æˆ‘ä»¬å¯çˆ±çš„ <code>recast</code> åº“ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">recastFileName</span>(<span class="params">path, fileName</span>) </span>&#123;</span><br><span class="line">	fs.readFile(path, <span class="function"><span class="keyword">function</span>(<span class="params">err, data</span>) </span>&#123;</span><br><span class="line">		<span class="comment">// è¯»å–æ–‡ä»¶å¤±è´¥/é”™è¯¯</span></span><br><span class="line">		<span class="keyword">if</span> (err) &#123;</span><br><span class="line">			<span class="keyword">throw</span> err</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">const</span> code = data.toString()</span><br><span class="line">		<span class="built_in">console</span>.log(code)</span><br><span class="line">		<span class="keyword">const</span> ast = recast.parse(code)</span><br><span class="line">		<span class="keyword">let</span> i = <span class="number">0</span></span><br><span class="line">		<span class="comment">// è¦åšçš„äº‹æƒ…å¾ˆç®€å•ï¼ŒæŠŠæ‰€æœ‰ var å®šä¹‰çš„ å¹¶ä¸”å€¼æ˜¯ Literal æ•´åˆèµ·æ¥</span></span><br><span class="line">		<span class="keyword">const</span> maps = &#123;&#125;</span><br><span class="line">		<span class="comment">// å„ä¸ªå­—æ®µçš„å¤‡æ³¨å­˜åœ¨è¿™</span></span><br><span class="line">		<span class="keyword">const</span> markMap = &#123;&#125;</span><br><span class="line">		<span class="keyword">let</span> markDown = <span class="string">''</span></span><br><span class="line">		recast.visit(ast, &#123;</span><br><span class="line">			visitExportNamedDeclaration: <span class="function"><span class="keyword">function</span>(<span class="params">path</span>) </span>&#123;</span><br><span class="line">				<span class="keyword">const</span> init = path.node.declaration.declarations[<span class="number">0</span>].init</span><br><span class="line">				<span class="keyword">const</span> key = path.node.declaration.declarations[<span class="number">0</span>].id.name</span><br><span class="line">				<span class="keyword">let</span> value = init.value</span><br><span class="line">				<span class="keyword">const</span> type = init.type</span><br><span class="line">				<span class="keyword">if</span> (type === <span class="string">'UnaryExpression'</span>) &#123;</span><br><span class="line">					value = <span class="built_in">eval</span>(<span class="string">`<span class="subst">$&#123;init.operator&#125;</span><span class="subst">$&#123;init.argument.value&#125;</span>`</span>)</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">if</span> (type === <span class="string">'Literal'</span> || type === <span class="string">'UnaryExpression'</span>) &#123;</span><br><span class="line">					maps[key] = value</span><br><span class="line"></span><br><span class="line">					path.node.comments &amp;&amp;</span><br><span class="line">						path.node.comments.map(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">							markDown = <span class="string">`/**</span></span><br><span class="line"><span class="string">* Enum for <span class="subst">$&#123;fileName&#125;</span></span></span><br><span class="line"><span class="string">* <span class="subst">$&#123;item.value&#125;</span></span></span><br><span class="line"><span class="string">* @enum &#123;number&#125;</span></span><br><span class="line"><span class="string">*/\n`</span></span><br><span class="line">						&#125;)</span><br><span class="line">					<span class="keyword">return</span> <span class="literal">null</span></span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">			&#125;,</span><br><span class="line">			visitVariableDeclaration: <span class="function"><span class="keyword">function</span>(<span class="params">path</span>) </span>&#123;</span><br><span class="line">				<span class="keyword">if</span> (</span><br><span class="line">					!path.value.declarations ||</span><br><span class="line">					!path.value.declarations[<span class="number">0</span>] ||</span><br><span class="line">					!path.value.declarations[<span class="number">0</span>].init.elements</span><br><span class="line">				) &#123;</span><br><span class="line">					<span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">				&#125;</span><br><span class="line">				<span class="built_in">console</span>.log(<span class="string">'å®šä¹‰'</span>)</span><br><span class="line">				<span class="built_in">console</span>.log(path.value.declarations[<span class="number">0</span>].init.elements)</span><br><span class="line">				path.value.declarations[<span class="number">0</span>].init.elements.map(<span class="function"><span class="params">element</span> =&gt;</span> &#123;</span><br><span class="line">					<span class="keyword">const</span> key = element.properties[<span class="number">0</span>].value.name</span><br><span class="line">					<span class="keyword">const</span> value = element.properties[<span class="number">1</span>].value.value</span><br><span class="line">					element.properties[<span class="number">0</span>].value = memberExpression(id(<span class="string">`<span class="subst">$&#123;fileName&#125;</span>Obj`</span>), id(key))</span><br><span class="line">					markMap[key] = value</span><br><span class="line">				&#125;)</span><br><span class="line">				<span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">			&#125;</span><br><span class="line">		&#125;)</span><br><span class="line">		<span class="keyword">if</span> (!<span class="built_in">Object</span>.keys(maps).length) &#123;</span><br><span class="line">			<span class="built_in">console</span>.log(<span class="string">'æ— éœ€è½¬æ¢'</span>)</span><br><span class="line">			<span class="keyword">return</span></span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">let</span> mapString = <span class="string">'&#123;\n'</span></span><br><span class="line">		<span class="built_in">Object</span>.keys(maps).map(<span class="function">(<span class="params">key, index</span>) =&gt;</span> &#123;</span><br><span class="line">			<span class="keyword">if</span> (markMap[key]) mapString += <span class="string">`  /** <span class="subst">$&#123;markMap[key]&#125;</span> */\n`</span></span><br><span class="line">			<span class="keyword">if</span> (index === <span class="built_in">Object</span>.keys(maps).length - <span class="number">1</span>) &#123;</span><br><span class="line">				mapString += <span class="string">`  "<span class="subst">$&#123;key&#125;</span>": <span class="subst">$&#123;maps[key]&#125;</span>\n`</span></span><br><span class="line">			&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">				mapString += <span class="string">`  "<span class="subst">$&#123;key&#125;</span>": <span class="subst">$&#123;maps[key]&#125;</span>,\n`</span></span><br><span class="line">			&#125;</span><br><span class="line">		&#125;)</span><br><span class="line">		mapString += <span class="string">'&#125;'</span></span><br><span class="line">		<span class="keyword">const</span> res = <span class="string">`const <span class="subst">$&#123;fileName&#125;</span>Obj = <span class="subst">$&#123;mapString&#125;</span>\nexport const <span class="subst">$&#123;fileName&#125;</span>Enum = Object.freeze(<span class="subst">$&#123;fileName&#125;</span>Obj)\n`</span></span><br><span class="line"></span><br><span class="line">		<span class="keyword">const</span> output = res + recast.print(ast).code</span><br><span class="line">		<span class="keyword">const</span> finel = recast.print(recast.parse(output)).code</span><br><span class="line">		<span class="built_in">console</span>.log(finel)</span><br><span class="line">		<span class="built_in">console</span>.log(output)</span><br><span class="line">		fs.writeFile(path, <span class="string">`<span class="subst">$&#123;markDown&#125;</span>\n<span class="subst">$&#123;finel&#125;</span>`</span>, &#123;&#125;, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">			<span class="built_in">console</span>.log(<span class="string">`wirte <span class="subst">$&#123;fileName&#125;</span> OK!`</span>)</span><br><span class="line">		&#125;)</span><br><span class="line">	&#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä»£ç çœ‹èµ·æ¥å¾ˆæ‡µé€¼ï¼Œè¿™é‡Œåªè®²è®²æ ¸å¿ƒä»£ç ã€‚  </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> map = [](&#123;</span><br><span class="line">	<span class="comment">// å¾ˆå®¹æ˜“çœ‹å‡ºæ¥ï¼Œè¿™ä¸ªæ–¹æ³•æ˜¯ç”¨æ¥æ•æ‰ export è¯­å¥çš„</span></span><br><span class="line">	visitExportNamedDeclaration: <span class="function"><span class="keyword">function</span>(<span class="params">path</span>) </span>&#123;</span><br><span class="line">		<span class="keyword">const</span> init = path.node.declaration.declarations[<span class="number">0</span>].init</span><br><span class="line">		<span class="keyword">const</span> key = path.node.declaration.declarations[<span class="number">0</span>].id.name</span><br><span class="line">		<span class="keyword">let</span> value = init.value</span><br><span class="line">		<span class="keyword">const</span> type = init.type</span><br><span class="line">		<span class="comment">/* å°†</span></span><br><span class="line"><span class="comment">      export const NORMAL_APPLY = 0</span></span><br><span class="line"><span class="comment">      æœ‰ç”¨çš„ä¿¡æ¯æ‹¿å‡ºæ¥ï¼Œå­˜è¿›å¯¹è±¡é‡Œ</span></span><br><span class="line"><span class="comment">      maps: &#123; NORMAL_APPLY: 0 &#125;</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">		<span class="keyword">if</span> (type === <span class="string">'Literal'</span> || type === <span class="string">'UnaryExpression'</span>) &#123;</span><br><span class="line">			maps[key] = value</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>å½“æˆ‘ä»¬æšä¸¾éƒ½å­˜åˆ° map å¯¹è±¡é‡Œçš„æ—¶å€™ï¼Œå°±å¯ä»¥æ‹¼æ¥ map å¯¹è±¡ï¼Œç„¶å å¡è¿› ä»£ç æ–‡ä»¶é‡Œäº†ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> mapString = <span class="string">'&#123;\n'</span></span><br><span class="line"><span class="built_in">Object</span>.keys(maps).map(<span class="function">(<span class="params">key, index</span>) =&gt;</span> &#123;</span><br><span class="line">	<span class="keyword">if</span> (markMap[key]) mapString += <span class="string">`  /** <span class="subst">$&#123;markMap[key]&#125;</span> */\n`</span></span><br><span class="line">	<span class="keyword">if</span> (index === <span class="built_in">Object</span>.keys(maps).length - <span class="number">1</span>) &#123;</span><br><span class="line">		mapString += <span class="string">`  "<span class="subst">$&#123;key&#125;</span>": <span class="subst">$&#123;maps[key]&#125;</span>\n`</span></span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		mapString += <span class="string">`  "<span class="subst">$&#123;key&#125;</span>": <span class="subst">$&#123;maps[key]&#125;</span>,\n`</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;)</span><br><span class="line">mapString += <span class="string">'&#125;'</span></span><br><span class="line">writeFile(mapString)</span><br></pre></td></tr></table></figure>
<p>å½“ç„¶ï¼Œè¿˜æœ‰å¾ˆå¤šåœ°æ–¹éœ€è¦æ³¨æ„ï¼Œæ¯”å¦‚æ–‡ä»¶å¤´ç»Ÿä¸€çš„å¤‡æ³¨ï¼Œæšä¸¾çš„å•ç‹¬å¤‡æ³¨ã€‚è¿™é‡Œå°±ä¸èµ˜è¿°äº†ã€‚ä½ å¯ä»¥ç¿»åˆ°æœ€ä¸Šé¢ç»†è¯»ã€‚</p>
<p>è¿™ä¸ªéœ€æ±‚åšçš„è¿˜ç®—é¡ºåˆ©ã€‚</p>
<h2 id="åˆä¸€ä¸ªéœ€æ±‚"><a href="#åˆä¸€ä¸ªéœ€æ±‚" class="headerlink" title="åˆä¸€ä¸ªéœ€æ±‚"></a>åˆä¸€ä¸ªéœ€æ±‚</h2><h3 id="å°ç¨‹åºè·¯ç”±å‚æ•°ä¿®æ”¹"><a href="#å°ç¨‹åºè·¯ç”±å‚æ•°ä¿®æ”¹" class="headerlink" title="å°ç¨‹åºè·¯ç”±å‚æ•°ä¿®æ”¹"></a>å°ç¨‹åºè·¯ç”±å‚æ•°ä¿®æ”¹</h3><p>å½“æˆ‘èŠ±äº†åŠå¤©åšå®Œ æšä¸¾åº“ çš„è½¬åŒ–åï¼Œå†…å¿ƒæœ‰ç‚¹å°æ¿€åŠ¨ï¼Œæ°å¥½å½“å‰ç‰ˆæœ¬æœ‰ä¸€ä¸ªéœ€æ±‚å’Œä¸Šé¢çš„éœ€æ±‚å¾ˆåƒã€‚  </p>
<p>å°ç¨‹åºé¡¹ç›®ï¼Œè·¯ç”±è·³è½¬æ˜¯è¿™æ ·çš„ï¼š<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wx.navigateTo(&#123;</span><br><span class="line">    url: <span class="string">`/pages/resumeOptimize?jobId=<span class="subst">$&#123;<span class="keyword">this</span>.jobId&#125;</span>&amp;resume_enhance_source=apply_work_success&amp;workid=<span class="subst">$&#123;<span class="keyword">this</span>.jobId&#125;</span>&amp;service_type=resume_optimization`</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p>
<p>é•¿ã€ä¸‘é™‹ã€åæœŸåŠ å‚æ•°å®¹æ˜“å‡ºé”™ã€‚  </p>
<p>æ‰€ä»¥éœ€è¦å†™æˆè¿™æ ·ã€‚<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">wx.navigateTo(&#123;</span><br><span class="line">  url: <span class="string">`/pages/resumeOptimize?<span class="subst">$&#123;qs.stringify(&#123;</span></span></span><br><span class="line"><span class="string"><span class="subst">    jobId: <span class="keyword">this</span>.jobId,</span></span></span><br><span class="line"><span class="string"><span class="subst">    resume_enhance_source: <span class="string">'apply_work_success'</span>,</span></span></span><br><span class="line"><span class="string"><span class="subst">    workid: <span class="keyword">this</span>.jobId,</span></span></span><br><span class="line"><span class="string"><span class="subst">    service_type: <span class="string">'resume_optimization'</span></span></span></span><br><span class="line"><span class="string"><span class="subst">  &#125;</span>)&#125;`</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p>
<p>ä¼˜é›…ï¼Œç¼©è¿›æ¼‚äº®ï¼Œå®¹æ˜“ç»´æŠ¤ã€‚  </p>
<h3 id="å†é—®é—®ç¥å¥‡çš„-AST-ï¼Ÿ"><a href="#å†é—®é—®ç¥å¥‡çš„-AST-ï¼Ÿ" class="headerlink" title="å†é—®é—®ç¥å¥‡çš„ AST ï¼Ÿ"></a>å†é—®é—®ç¥å¥‡çš„ AST ï¼Ÿ</h3><p>è¿™æ¬¡çš„æ˜¾ç„¶æ¯”ä¸Šæ¬¡éš¾ã€‚é¦–å…ˆä»£ç æ–‡ä»¶ä¸æ˜¯ jsï¼Œè€Œæ˜¯ <code>.wpy</code>ã€‚  </p>
<p>å› ä¸ºå°ç¨‹åºç”¨äº† wepy æ¡†æ¶ï¼Œç±» vue ç»“æ„ã€‚<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>é¦–å…ˆè¦ä»è¿™ä¸ªç»“æ„é‡Œå•ç‹¬å°† <code>script</code> æŠ½å‡ºæ¥ã€‚å½“ç„¶æ˜¯ç”¨å¼ºå¤§çš„æ­£åˆ™äº†ã€‚<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">function getScript(code) &#123;</span><br><span class="line">  let jsReg = /<span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript">[\s|\S]*?<span class="xml"><span class="tag">&lt;<span class="name">\</span>/<span class="attr">script</span>&gt;</span></span><span class="regexp">/ig;</span></span></span><br><span class="line"><span class="javascript">  <span class="keyword">const</span> scriptColletion = code.match(jsReg)[<span class="number">0</span>].replace(<span class="regexp">/&lt;script&gt;/</span>, <span class="string">''</span>).replace(<span class="regexp">/&lt;\/script&gt;/</span>, <span class="string">''</span>);</span></span><br><span class="line"><span class="javascript">  <span class="keyword">return</span> scriptColletion</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>å¾ˆå®¹æ˜“æ‹¿åˆ°äº† <code>script</code> çš„å†…å®¹ã€‚<br>å‡è®¾æˆ‘ä»¬å°† ast æ“ä½œå®Œæˆäº†ï¼Œè¦å°†ä»£ç æ–‡ä»¶å­˜å›å»ï¼ŒåŒæ ·çš„ã€‚<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">// å†æŠŠscriptè®¾ç½®å›å»</span><br><span class="line">function setScript(code, script) &#123;</span><br><span class="line">  let jsReg = /<span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript">[\s|\S]*?<span class="xml"><span class="tag">&lt;<span class="name">\</span>/<span class="attr">script</span>&gt;</span></span><span class="regexp">/ig;</span></span></span><br><span class="line"><span class="javascript">  <span class="keyword">return</span> code.replace(jsReg, <span class="string">`&lt;script&gt;\n<span class="subst">$&#123;script&#125;</span></span></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span>`)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="éœ€æ±‚åˆ†æ"><a href="#éœ€æ±‚åˆ†æ" class="headerlink" title="éœ€æ±‚åˆ†æ"></a>éœ€æ±‚åˆ†æ</h3><p>ä¸ŠèŠ‚åªæ˜¯ç®€å•çš„å®ç°äº†ä»£ç çš„å­˜å–ï¼Œé‡å¤´æˆç»ˆäºæ¥äº†ã€‚é¦–å…ˆåˆ†æä¸‹æˆ‘ä»¬è¦åšä»€ä¹ˆã€‚  </p>
<ul>
<li>æ‹¦æˆªä»£ç é‡Œçš„ <code>wx.navigateTo</code> æˆ– <code>wepy.navigateTo</code>ï¼Œè¿™ä¸¤ä¸ªapiç›¸åŒï¼Œå¼€å‘è€…éƒ½å¯èƒ½è°ƒç”¨ </li>
<li>å°†è¿™ä¸ª api çš„å‚æ•°ï¼Œç”±æ¨¡ç‰ˆå­—ç¬¦ä¸²ï¼Œæ›¿æ¢ä¸º <code>qs.stringify</code> æ–¹æ³•è°ƒç”¨  </li>
<li>å¦‚æœè¯¥æ–‡ä»¶æœ‰æ›¿æ¢æ“ä½œï¼Œå¹¶ä¸”ï¼Œæ–‡ä»¶å¤´éƒ¨æ²¡æœ‰ <code>import qs from &#39;qs&#39;</code>,éœ€è¦æ‰‹åŠ¨åŠ ä¸Š  <h4 id="æ‹¦æˆªapi"><a href="#æ‹¦æˆªapi" class="headerlink" title="æ‹¦æˆªapi"></a>æ‹¦æˆªapi</h4>api æ–¹æ³•è°ƒç”¨æ˜¾ç„¶æ˜¯ä¸€ä¸ª <code>ExpressionStatement</code>ï¼Œå› æ­¤æˆ‘ä»¬å¾ˆç®€å•çš„æ‹¦æˆªåˆ°äº†å®ƒï¼Œå¹¶ä¸”ä¹‹åçš„æ“ä½œéƒ½æ˜¯åœ¨ <code>visitExpressionStatement</code> å›è°ƒé‡Œåšçš„ã€‚<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">recast.visit(ast, &#123;</span><br><span class="line">  visitExpressionStatement: function(path) &#123;</span><br><span class="line">    const callee = path.node.expression.callee</span><br><span class="line">    if(!callee || !callee.object) &#123;</span><br><span class="line">      return false</span><br><span class="line">    &#125;</span><br><span class="line">    const objName = callee.object.name</span><br><span class="line">    const fnName = callee.property.name</span><br><span class="line">    // è°ƒç”¨è€…æ˜¯wx æˆ–è€… wepy</span><br><span class="line">    if(objName === 'wx' || objName === 'wepy') &#123;</span><br><span class="line">      // è·³è½¬</span><br><span class="line">      if(fnName === 'navigateTo') &#123;</span><br><span class="line">        // æ‹¦æˆªåˆ°äº†</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    return false</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="æ¨¡ç‰ˆå­—ç¬¦ä¸²æ›¿æ¢"><a href="#æ¨¡ç‰ˆå­—ç¬¦ä¸²æ›¿æ¢" class="headerlink" title="æ¨¡ç‰ˆå­—ç¬¦ä¸²æ›¿æ¢"></a>æ¨¡ç‰ˆå­—ç¬¦ä¸²æ›¿æ¢</h4><p>æ‚ªå¤¢ã®èµ·æº  </p>
<p>è¿™é‡Œæ˜¯æ ¸å¿ƒåŠŸèƒ½ï¼Œå®ƒæ¶ˆè€—äº†æˆ‘åŠå¤©å¤šæ—¶é—´ã€‚<br>æˆ‘ä»¬ä½äºä»¥ä¸Šä»£ç  â€˜æ‹¦æˆªåˆ°äº†â€™ ä½ç½®ã€‚åˆ©ç”¨ devTool æ‰¾åˆ°äº† wx.navigateTo çš„è¯­æ³•æ ‘æ„æˆã€‚<br>ä¸¾ä¸ªğŸŒ°ï¼š<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wepy.navigateTo(&#123;</span><br><span class="line">  url: <span class="string">`/pages/detail/jobDetail?id=<span class="subst">$&#123;e.id&#125;</span>&amp;from=job_detail&amp;num=<span class="subst">$&#123;e.index&#125;</span>&amp;uniqueKey=<span class="subst">$&#123;uniqueKey&#125;</span>`</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">pre</span>&gt;</span></span><br><span class="line">if(fnName === 'navigateTo') &#123;</span><br><span class="line">  const argument = path.node.expression.arguments[0]</span><br><span class="line">  let &#123;expressions, quasis&#125; = argument.properties[0].value</span><br><span class="line">  if(!expressions || !quasis || !expressions.length) &#123;</span><br><span class="line">    return false</span><br><span class="line">  &#125;</span><br><span class="line">  if(expressions.length <span class="tag">&lt; <span class="attr">2</span>) &#123;<span class="attr">return</span> <span class="attr">false</span>&#125;</span></span><br><span class="line"><span class="tag">  <span class="attr">expressions</span> = <span class="string">expressions.map((val)</span> =&gt;</span> &#123;</span><br><span class="line">      const res = recast.print(val)</span><br><span class="line">      return res.code</span><br><span class="line">  &#125;)</span><br><span class="line">  let url = ''</span><br><span class="line">  quasis = quasis.map((val) =&gt; &#123;</span><br><span class="line">      const path = val.original.value.cooked</span><br><span class="line">      if(/\?/.test(path)) &#123;</span><br><span class="line">        // æŠŠ url å­˜ä¸‹æ¥</span><br><span class="line">        url = path.split('?')[0]</span><br><span class="line">        return path.split('?')[1]</span><br><span class="line">      &#125;</span><br><span class="line">      return path</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">pre</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>äº‹å®ä¸Šï¼Œastå°†è¿™è¡Œä»£ç åˆ†å‰²æˆäº†ä¸¤ç»„ï¼Œä¸€ç»„æ˜¯ expressionsï¼Œä¸€ç»„æ˜¯ quasisï¼Œæˆ‘å°†è¿™äºŒè€…æ‰“å°å‡ºæ¥ã€‚å‰è€…æ˜¯è¡¨è¾¾å¼ï¼Œåè€…æ˜¯å­—ç¬¦ä¸²ã€‚æ­£å¥½ è¡¨è¾¾å¼é•¿åº¦ = å­—ç¬¦ä¸²é•¿åº¦ - 1ã€‚<br>è¿™ç¬¦åˆæ¨¡ç‰ˆå­—ç¬¦ä¸²çš„æ ¼å¼ã€‚<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">"e.id"</span>, <span class="string">"e.index"</span>, <span class="string">"uniqueKey"</span>]</span><br><span class="line">[<span class="string">"id="</span>, <span class="string">"&amp;from=job_detail&amp;num="</span>, <span class="string">"&amp;uniqueKey="</span>, <span class="string">""</span>]</span><br></pre></td></tr></table></figure></p>
<p>æˆ‘éœ€è¦å°†è¿™ä¸¤ä¸ªæ•°ç»„æ‹¼æ¥èµ·æ¥ï¼Œå¹¶ç»™å­—ç¬¦ä¸²åŠ ä¸Šå¼•å·ã€‚<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">pre</span>&gt;</span></span><br><span class="line"></span><br><span class="line">const express = assignArray(quasis, expressions).join('').split('&amp;')</span><br><span class="line">function assignArray(arr2, arr1) &#123;</span><br><span class="line">  // æŠŠ arr2é‡Œé¢çš„å­—ç¬¦ä¸²åŠ ä¸Šå¼•å·</span><br><span class="line">  arr2 = arr2.map((val) =&gt; val.split('&amp;').map((equel) =&gt; &#123;</span><br><span class="line">      if(!equel || !equel.split('=')[1]) &#123;</span><br><span class="line">        return equel</span><br><span class="line">      &#125;</span><br><span class="line">      const value = '\'' + equel.split('=')[1] + '\''</span><br><span class="line">      return [equel.split('=')[0], value].join('=')</span><br><span class="line">    &#125;).join('&amp;'))</span><br><span class="line">  arr1.forEach((item, index) =&gt; &#123;</span><br><span class="line">      arr2.splice(2 * (index + 1) - 1, 0, item)</span><br><span class="line">  &#125;)</span><br><span class="line">  return arr2</span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">pre</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>æœ€ç»ˆæ˜¯è¿™ä¸ªæ ·å­ï¼š<br><code>[&quot;id=e.id&quot;, &quot;from=&#39;job_detail&#39;&quot;, &quot;num=e.index&quot;, &quot;uniqueKey=uniqueKey&quot;]</code><br>æ¥ä¸‹æ¥ï¼Œå°†ä¸Šé¢çš„æ•°ç»„è½¬åŒ–æˆå‡½æ•°çš„å‚æ•°å³å¯<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">const</span> results = giveQsString(express, url)</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">giveQsString</span>(<span class="params">expressArr, url</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> str = <span class="string">`url: \`<span class="subst">$&#123;url&#125;</span>?\$&#123;qs.stringify(&#123;\n`</span></span><br><span class="line">  expressArr.map(<span class="function">(<span class="params">val, index</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> [key, value] = val.split(<span class="string">'='</span>)</span><br><span class="line">    <span class="keyword">if</span>(index === expressArr.length - <span class="number">1</span>)</span><br><span class="line">      str += <span class="string">`  <span class="subst">$&#123;key&#125;</span>: <span class="subst">$&#123;value&#125;</span>\n`</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">      str += <span class="string">`  <span class="subst">$&#123;key&#125;</span>: <span class="subst">$&#123;value&#125;</span>,\n`</span></span><br><span class="line">  &#125;)</span><br><span class="line">  str += <span class="string">`&#125;)&#125;\``</span></span><br><span class="line">  <span class="built_in">console</span>.log(str)</span><br><span class="line">  <span class="keyword">return</span> str</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>æœ€ç»ˆæ˜¯è¿™ä¸ªæ ·å­çš„ã€‚<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">url: `/pages/detail/jobDetail?$&#123;qs.stringify(&#123;</span></span><br><span class="line"><span class="comment">  id: e.id,</span></span><br><span class="line"><span class="comment">  from: 'job_detail',</span></span><br><span class="line"><span class="comment">  num: e.index,</span></span><br><span class="line"><span class="comment">  uniqueKey: uniqueKey</span></span><br><span class="line"><span class="comment">&#125;)&#125;`</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></p>
<p>æœ€é‡è¦çš„ä¸€æ­¥ï¼Œå°†è¯¥å‚æ•°ï¼Œå¡«åˆ° navigate çš„æ–¹æ³•ä¸­<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">path.node.expression.arguments[<span class="number">0</span>].properties[<span class="number">0</span>] = templateElement(&#123; </span><br><span class="line">  <span class="string">"cooked"</span>: results, <span class="string">"raw"</span>: results </span><br><span class="line">&#125;, <span class="literal">false</span>)</span><br></pre></td></tr></table></figure></p>
<p>å°±è¿™æ ·ï¼Œæ ¸å¿ƒçš„astå°±å®Œæˆäº†ã€‚</p>
<h4 id="åŠ ä¸Š-qs"><a href="#åŠ ä¸Š-qs" class="headerlink" title="åŠ ä¸Š qs"></a>åŠ ä¸Š qs</h4><p>å¦‚æœè¯¥æ–‡ä»¶è¿›è¡Œäº†ä»¥ä¸Šæ­¥éª¤ï¼Œé‚£å®ƒå°±éœ€è¦è¿›è¡Œ import qsï¼Œè¿™é‡Œåªéœ€è¦å¯¹ ImportDeclaration è¿›è¡Œåˆ¤æ–­ï¼Œå¦‚æœæ²¡æœ‰å¯¼å…¥ qs æ¨¡å—ï¼Œåˆ™å‘Šè¯‰ä¸‹æ¸¸ï¼Œåœ¨æ–‡ä»¶å¤´éƒ¨è¿½åŠ  import è¯­å¥ã€‚<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">visitImportDeclaration: function(path) &#123;</span><br><span class="line">  // å¦‚æœæ¨¡å—å¼•å…¥äº†qsï¼Œåˆ™ä¸éœ€è¦å¯¼å…¥</span><br><span class="line">  if(path.node.source.value === 'qs') &#123;</span><br><span class="line">    needQs = false</span><br><span class="line">  &#125;</span><br><span class="line">  return false</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>ç”¨æˆ‘å‘¨æŠ¥ä¸Šçš„è¯æ¥æ€»ç»“å§</p>
<blockquote>
<p>è¿™å‘¨çš„ä¸¤ä¸ªéœ€æ±‚éƒ½ç”¨ä¸Šäº†ASTï¼Œä¹Ÿæ˜¯ç¬¬ä¸€æ¬¡å°†ASTç”¨åœ¨äº†å®é™…é¡¹ç›®ä¸­ï¼Œä¸¤ä¸ªéœ€æ±‚äº§ç”Ÿçš„æ•ˆæœä¹Ÿä¸åŒã€‚<br>jobmd_enum ä»£ç ç»“æ„å’Œæ³¨é‡Šå˜æ›´ï¼šè¿™ä¸ªåº“çš„ä»£ç æ–‡ä»¶æ ¼å¼æ¯”è¾ƒç»Ÿä¸€ï¼Œæ–‡ä»¶æ•°è¾ƒå¤šï¼Œä¸å¤ªé€‚åˆæ‰‹åŠ¨ä¸€ä¸ªä¸ªæ”¹å†™ï¼Œç”¨ASTåšå‡å°‘äº†ä¸å°‘æ—¶é—´ï¼Œä¸”éš¾åº¦ä¸é«˜<br>jobmd-weapp è·¯ç”±å‚æ•°èµ°qs: è¿™ä¸ªåº“çš„ä»£ç æ ¼å¼æ˜¯wepyç±»å‹ï¼Œåšèµ·æ¥éš¾åº¦æ¯”è¾ƒé«˜ï¼ŒèŠ±äº†ä¸€æ•´å¤©çš„æ—¶é—´å†™ASTä»£ç ï¼Œæœ€ç»ˆä¹Ÿå®ç°äº†å…¨å±€è·¯ç”±çš„æ›¿æ¢ï¼Œæ›¿æ¢åå‘ç°éœ€è¦æ›¿æ¢çš„æ–‡ä»¶å¹¶ä¸å¤šï¼Œæ‰€ä»¥è¿™æ˜¯ä¸€ä¸ªåä¾‹ã€‚<br>å› æ­¤ï¼Œåœ¨å†³å®šç”¨ASTå‰ä¸€å®šè¦å…ˆè°ƒç ”æ˜¯å¦é€‚åˆç”¨ï¼Œæˆ‘è®¤ä¸ºéœ€è¦æ»¡è¶³ä»¥ä¸‹ä¸¤ä¸ªæ¡ä»¶:<br>1ï¼Œast ä»£ç å®¹æ˜“å†™ã€‚ 2ï¼Œé‡å¤çš„å·¥ä½œé‡å¤§</p>
</blockquote>

        </section>
    </article>
    
        
  </div>
  <aside>
    
    <div class="toc-container">
        <h1>ç›®å½•</h1>
        <div class="content">
            <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#AST-å’Œ-æˆ‘"><span class="toc-number">1.</span> <span class="toc-text">AST å’Œ æˆ‘</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#æšä¸¾åº“-å’Œ-JSDOC-çš„ç¢°æ’"><span class="toc-number">2.</span> <span class="toc-text">æšä¸¾åº“ å’Œ JSDOC çš„ç¢°æ’</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#ä½ ä¸ºä»€ä¹ˆä¸é—®é—®ç¥å¥‡çš„-AST-å‘¢"><span class="toc-number">2.1.</span> <span class="toc-text">ä½ ä¸ºä»€ä¹ˆä¸é—®é—®ç¥å¥‡çš„ AST å‘¢</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#åˆä¸€ä¸ªéœ€æ±‚"><span class="toc-number">3.</span> <span class="toc-text">åˆä¸€ä¸ªéœ€æ±‚</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#å°ç¨‹åºè·¯ç”±å‚æ•°ä¿®æ”¹"><span class="toc-number">3.1.</span> <span class="toc-text">å°ç¨‹åºè·¯ç”±å‚æ•°ä¿®æ”¹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#å†é—®é—®ç¥å¥‡çš„-AST-ï¼Ÿ"><span class="toc-number">3.2.</span> <span class="toc-text">å†é—®é—®ç¥å¥‡çš„ AST ï¼Ÿ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#éœ€æ±‚åˆ†æ"><span class="toc-number">3.3.</span> <span class="toc-text">éœ€æ±‚åˆ†æ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#æ‹¦æˆªapi"><span class="toc-number">3.3.1.</span> <span class="toc-text">æ‹¦æˆªapi</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#æ¨¡ç‰ˆå­—ç¬¦ä¸²æ›¿æ¢"><span class="toc-number">3.3.2.</span> <span class="toc-text">æ¨¡ç‰ˆå­—ç¬¦ä¸²æ›¿æ¢</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#åŠ ä¸Š-qs"><span class="toc-number">3.3.3.</span> <span class="toc-text">åŠ ä¸Š qs</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#æ€»ç»“"><span class="toc-number">4.</span> <span class="toc-text">æ€»ç»“</span></a></li></ol>
        </div>
    </div>
    
  </aside>
</main>



  <footer>
  <div class="copyright">
    <div>
      &copy; 2021 | Powered by <a href="https://hexo.io" target="_blank">Hexo</a>&nbsp
    </div>
    <div>
      Theme by <a href="https://github.com/lewis-geek/hexo-theme-Aath" target="_blank">Aath</a>
    </div>
  </div>
</footer>


<script src="https://cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>
<script src="/lib/in-view.min.js"></script>
<script src="/lib/lodash.min.js"></script>
<script>
  var isDown = true
  var oldY = 0
  inView.offset(50)

  document.body.addEventListener('touchstart', function(){});
  
  window.addEventListener('scroll', _.throttle(e => {
    var currentY = window.scrollY
    if((oldY - currentY) < 0) {
      isDown = true
    } else {
      isDown = false
    }
    oldY = currentY
  }, 250))

  $("article img").each(function() {
      var strA = "<a data-fancybox='gallery' href='" + this.src + "'></a>";
      $(this).wrapAll(strA);
  });

  $('.toc-link').each(function() {
      var href = $(this).attr("href");
      
      inView(href).on('exit', () => {
        if (isDown) {
          handleActive(href)
        }
      })

      inView(href).on('enter', () => {
        if (!isDown) {
          handleActive(href)
        }
      })

      this.onclick = function(e) {
        var pos = $(href).offset().top - 10;
        $("html,body").animate({scrollTop: pos}, 300);
        setTimeout(() => {
          handleActive(href)
        }, 350)
        return false
      }
  })

  function handleActive(href) {
    document.querySelectorAll('.toc-link').forEach(elm => {
      elm.classList.remove('active')
    })
    document.querySelector(".toc [href='"+ href +"']").classList.add('active')
  }
</script>
<script src="/lib/jquery.fancybox.min.js"></script>


</body>
</html>
